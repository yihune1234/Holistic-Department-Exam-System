@model HolisticDepartmentExamSystem.Models.Exam
@{
    ViewData["Title"] = "Student Passwords";
    Layout = "~/Views/Shared/_CoordinatorLayout.cshtml";
    ViewBag.ExamId = Model.ExamId;
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-1">
                <li class="breadcrumb-item small"><a asp-action="ExamList">Exams</a></li>
                <li class="breadcrumb-item small"><a asp-action="ManageExam" asp-route-examId="@Model.ExamId">Control Hub</a></li>
                <li class="breadcrumb-item small active">Passwords</li>
            </ol>
        </nav>
        <h2 class="h4 mb-0 fw-bold">Manage Student Access</h2>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="content-card">
            <div class="card-header">
                <h3 class="card-title">Generated Access Codes</h3>
                <div>
                    <span class="badge bg-primary rounded-pill">@(Model.ExamPasswords?.Count ?? 0) Students Assigned</span>
                </div>
            </div>
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Student Name</th>
                            <th>Access Code</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var p in Model.ExamPasswords.OrderBy(ep => ep.Student.FullName))
                        {
                            <tr>
                                <td class="fw-bold">@p.Student.FullName</td>
                                <td>
                                    <code class="bg-light p-2 rounded fw-bold text-primary" style="font-size: 1rem; letter-spacing: 1px;">@p.PasswordHash</code>
                                </td>
                                <td>
                                    @if (p.IsUsed)
                                    {
                                        <span class="badge-soft badge-soft-gray"><i class="bi bi-person-check-fill me-1"></i> Already Used</span>
                                    }
                                    else
                                    {
                                        <span class="badge-soft badge-soft-green"><i class="bi bi-unlock-fill me-1"></i> Available</span>
                                    }
                                </td>
                            </tr>
                        }
                        @if (Model.ExamPasswords == null || !Model.ExamPasswords.Any())
                        {
                            <tr>
                                <td colspan="3" class="text-center py-5 text-muted">
                                    <i class="bi bi-key-fill mb-2" style="font-size: 2rem;"></i>
                                    <p>No passwords generated yet.</p>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="content-card">
            <div class="card-header bg-primary text-white">
                <h3 class="card-title text-white">Generate Codes</h3>
            </div>
            <div class="card-body">
                <form asp-action="GeneratePasswords" method="post">
                    <input type="hidden" name="examId" value="@Model.ExamId" />
                    <div class="mb-3">
                        <label class="form-label fw-bold small">Password Length</label>
                        <select class="form-select" name="length">
                            <option value="6">6 Characters (Medium)</option>
                            <option value="8" selected>8 Characters (Strong)</option>
                            <option value="12">12 Characters (Advanced)</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="btn-academic btn-academic-primary w-100 justify-content-center">
                        <i class="bi bi-magic me-2"></i> Generate For All Students
                    </button>
                    
                    <div class="alert alert-info border-0 mt-4 py-2 small">
                        <i class="bi bi-info-circle me-1"></i> This will generate NEW codes for all assigned students and deactivate any previously unused codes.
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
