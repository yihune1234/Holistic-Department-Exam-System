@model HolisticDepartmentExamSystem.Models.Student
@{
    ViewData["Title"] = "Student Details";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="content-card fade-in-up">
    <div class="card-header">
        <h3 class="card-title">Student Profile</h3>
        <div style="display: flex; gap: 1rem;">
            <a asp-action="EditStudent" asp-route-id="@Model.StudentId" class="btn-custom btn-primary-custom">
                <span>‚úèÔ∏è</span> Edit Student
            </a>
            <a asp-action="ManageStudents" class="btn-custom btn-outline-custom">
                <span>‚Üê</span> Back to Students
            </a>
        </div>
    </div>

    <!-- Student Information -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; padding: 1.5rem; background: var(--sidebar-bg); border-radius: 10px; margin-bottom: 1.5rem;">
        <div>
            <div style="text-align: center; margin-bottom: 1.5rem;">
                <div style="width: 100px; height: 100px; border-radius: 50%; background: var(--primary-gradient); display: flex; align-items: center; justify-content: center; font-size: 2.5rem; font-weight: 700; margin: 0 auto 1rem;">
                    @Model.FullName.Substring(0, 1).ToUpper()
                </div>
                <h3 style="margin-bottom: 0.5rem;">@Model.FullName</h3>
                <p style="color: var(--text-secondary); margin: 0;">@Model.Email</p>
            </div>
        </div>

        <div style="display: grid; gap: 1rem;">
            <div>
                <p style="margin: 0; color: var(--text-secondary); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px;">Department</p>
                <p style="margin: 0.25rem 0 0 0; font-weight: 600; font-size: 1.125rem;">
                    <span class="badge-custom badge-active">@(Model.Department ?? "N/A")</span>
                </p>
            </div>
            <div>
                <p style="margin: 0; color: var(--text-secondary); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px;">Year of Study</p>
                <p style="margin: 0.25rem 0 0 0; font-weight: 600; font-size: 1.125rem;">
                    <span class="badge-custom badge-draft">Year @Model.YearOfStudy</span>
                </p>
            </div>
            <div>
                <p style="margin: 0; color: var(--text-secondary); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px;">Username</p>
                <p style="margin: 0.25rem 0 0 0; font-weight: 600; font-size: 1.125rem;">@(Model.User?.Username ?? "N/A")</p>
            </div>
            <div>
                <p style="margin: 0; color: var(--text-secondary); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px;">Account Status</p>
                <p style="margin: 0.25rem 0 0 0;">
                    @if (Model.User?.Status == true)
                    {
                        <span class="badge-custom badge-active">Active</span>
                    }
                    else
                    {
                        <span class="badge-custom badge-inactive">Inactive</span>
                    }
                </p>
            </div>
        </div>
    </div>

    <!-- Exam Performance -->
    <div class="card-header" style="margin-top: 2rem;">
        <h3 class="card-title">Exam Performance</h3>
    </div>

    @if (Model.ExamAttempts != null && Model.ExamAttempts.Any())
    {
        <!-- Performance Stats -->
        <div class="stats-grid" style="margin-bottom: 1.5rem;">
            <div class="stat-card">
                <div class="stat-icon">üìù</div>
                <div class="stat-label">Total Attempts</div>
                <div class="stat-value">@Model.ExamAttempts.Count</div>
            </div>

            <div class="stat-card success">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-label">Completed</div>
                <div class="stat-value">@Model.ExamAttempts.Count(ea => ea.Status == "Completed")</div>
            </div>

            <div class="stat-card info">
                <div class="stat-icon">üìä</div>
                <div class="stat-label">Average Score</div>
                <div class="stat-value">
                    @if (Model.ExamAttempts.Any(ea => ea.Result != null))
                    {
                        @Model.ExamAttempts.Where(ea => ea.Result != null).Average(ea => ea.Result.TotalScore).ToString("F1")
                        <span style="font-size: 1rem;">%</span>
                    }
                    else
                    {
                        <span style="font-size: 1.5rem;">N/A</span>
                    }
                </div>
            </div>

            <div class="stat-card warning">
                <div class="stat-icon">‚è±Ô∏è</div>
                <div class="stat-label">In Progress</div>
                <div class="stat-value">@Model.ExamAttempts.Count(ea => ea.Status == "In Progress")</div>
            </div>
        </div>

        <!-- Exam Attempts Table -->
        <div class="table-responsive">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Exam Title</th>
                        <th>Start Time</th>
                        <th>End Time</th>
                        <th>Status</th>
                        <th>Score</th>
                        <th>Grade</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var attempt in Model.ExamAttempts.OrderByDescending(ea => ea.StartTime))
                    {
                        <tr>
                            <td>
                                <div style="font-weight: 600;">@attempt.Exam?.Title</div>
                            </td>
                            <td style="color: var(--text-secondary); font-size: 0.875rem;">
                                @attempt.StartTime.ToString("MMM dd, yyyy hh:mm tt")
                            </td>
                            <td style="color: var(--text-secondary); font-size: 0.875rem;">
                                @(attempt.EndTime?.ToString("MMM dd, yyyy hh:mm tt") ?? "N/A")
                            </td>
                            <td>
                                @if (attempt.Status == "Completed")
                                {
                                    <span class="badge-custom badge-published">Completed</span>
                                }
                                else if (attempt.Status == "In Progress")
                                {
                                    <span class="badge-custom badge-draft">In Progress</span>
                                }
                                else
                                {
                                    <span class="badge-custom badge-closed">@attempt.Status</span>
                                }
                            </td>
                            <td>
                                @if (attempt.Result != null)
                                {
                                    <span style="font-weight: 600; color: #4facfe;">@attempt.Result.TotalScore.ToString("F1")%</span>
                                }
                                else
                                {
                                    <span style="color: var(--text-secondary);">N/A</span>
                                }
                            </td>
                            <td>
                                @if (attempt.Result != null)
                                {
                                    <span class="badge-custom badge-published">@attempt.Result.Grade</span>
                                }
                                else
                                {
                                    <span style="color: var(--text-secondary);">N/A</span>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
    else
    {
        <div style="text-align: center; padding: 3rem; color: var(--text-secondary);">
            <div style="font-size: 3rem; margin-bottom: 1rem;">üìù</div>
            <div style="font-size: 1.125rem;">No exam attempts yet</div>
            <div style="font-size: 0.875rem; margin-top: 0.5rem;">This student hasn't taken any exams</div>
        </div>
    }
</div>

<!-- Actions -->
<div class="content-card fade-in-up" style="margin-top: 1.5rem;">
    <div class="card-header">
        <h3 class="card-title">Actions</h3>
    </div>
    <div style="display: flex; gap: 1rem; flex-wrap: wrap; padding: 1rem;">
        <a asp-action="EditStudent" asp-route-id="@Model.StudentId" class="btn-custom btn-primary-custom">
            <span>‚úèÔ∏è</span> Edit Profile
        </a>
        @if (Model.User != null)
        {
            <a asp-action="EditUser" asp-route-id="@Model.User.UserId" class="btn-custom btn-outline-custom">
                <span>üîë</span> Manage Account
            </a>
        }
        <form asp-action="DeleteStudent" asp-route-id="@Model.StudentId" method="post" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this student? This action cannot be undone.');">
            <button type="submit" class="btn-custom btn-danger-custom">
                <span>üóëÔ∏è</span> Delete Student
            </button>
        </form>
    </div>
</div>
